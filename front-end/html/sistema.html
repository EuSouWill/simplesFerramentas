<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detectando Sistema...</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 500px;
            width: 90%;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        h1 {
            font-size: 2.2em;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .status {
            font-size: 1.1em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .system-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
            display: none;
        }

        .info-item {
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .info-label {
            font-weight: bold;
            color: #ffd700;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            width: 0%;
            transition: width 0.3s ease;
        }

        .success-message {
            font-size: 1.2em;
            font-weight: bold;
            color: #4CAF50;
            margin-top: 15px;
            display: none;
        }

        .error-message {
            font-size: 1.1em;
            color: #ff6b6b;
            margin-top: 15px;
            display: none;
        }

        .email-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        @media (max-width: 480px) {
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loader"></div>
        <h1>Analisando Sistema</h1>
        <div class="status" id="status">Coletando informa√ß√µes do dispositivo...</div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
        
        <div class="system-info" id="systemInfo">
            <div class="info-item">
                <span class="info-label">Sistema Operacional:</span>
                <span id="osInfo">Detectando...</span>
            </div>
            <div class="info-item">
                <span class="info-label">Navegador:</span>
                <span id="browserInfo">Detectando...</span>
            </div>
            <div class="info-item">
                <span class="info-label">Dispositivo:</span>
                <span id="deviceInfo">Detectando...</span>
            </div>
            <div class="info-item">
                <span class="info-label">Resolu√ß√£o:</span>
                <span id="screenInfo">Detectando...</span>
            </div>
            <div class="info-item">
                <span class="info-label">Idioma:</span>
                <span id="languageInfo">Detectando...</span>
            </div>
            <div class="info-item">
                <span class="info-label">IP:</span>
                <span id="ipInfo">Obtendo...</span>
            </div>
            <div class="info-item">
                <span class="info-label">Localiza√ß√£o:</span>
                <span id="locationInfo">Obtendo...</span>
            </div>
        </div>
        
        <div class="email-status" id="emailStatus">
            <div id="emailMessage">Enviando relat√≥rio por email...</div>
        </div>
        
        <div class="success-message" id="successMessage">
            ‚úÖ Relat√≥rio enviado com sucesso para william.regis@simplesdental.com
        </div>
        
        <div class="error-message" id="errorMessage">
            ‚ö†Ô∏è Erro ao enviar email. Informa√ß√µes salvas localmente.
        </div>
    </div>

        <script>
        class SystemDetector {
            constructor() {
                this.systemInfo = {};
                this.steps = [
                    { name: 'Detectando Sistema Operacional', progress: 15 },
                    { name: 'Identificando Navegador', progress: 30 },
                    { name: 'Coletando Informa√ß√µes do Dispositivo', progress: 45 },
                    { name: 'Obtendo Dados de Rede', progress: 60 },
                    { name: 'Capturando Screenshot', progress: 75 },
                    { name: 'Preparando Relat√≥rio', progress: 90 },
                    { name: 'Enviando por Email', progress: 100 }
                ];
                this.currentStep = 0;
                this.init();
            }

            async init() {
                await this.runDetectionSteps();
                this.showResults();
                await this.sendEmail();
            }

            async runDetectionSteps() {
                for (let i = 0; i < this.steps.length; i++) {
                    const step = this.steps[i];
                    
                    document.getElementById('status').textContent = step.name;
                    document.getElementById('progress').style.width = step.progress + '%';
                    
                    await this.executeDetectionStep(i);
                    await this.sleep(800);
                }
            }

            async executeDetectionStep(stepIndex) {
                switch(stepIndex) {
                    case 0:
                        this.detectOperatingSystem();
                        break;
                    case 1:
                        this.detectBrowser();
                        break;
                    case 2:
                        this.detectDevice();
                        break;
                    case 3:
                        await this.getNetworkInfo();
                        break;
                    case 4:
                        await this.captureScreenshot();
                        break;
                    case 5:
                        this.prepareReport();
                        break;
                    case 6:
                        break;
                }
            }

            detectOperatingSystem() {
                const userAgent = navigator.userAgent;
                const platform = navigator.platform;
                
                let os = 'Desconhecido';
                let version = '';
                
                if (userAgent.indexOf('Windows NT 10.0') !== -1) {
                    os = 'Windows';
                    version = '10/11';
                } else if (userAgent.indexOf('Windows NT 6.3') !== -1) {
                    os = 'Windows';
                    version = '8.1';
                } else if (userAgent.indexOf('Windows NT 6.2') !== -1) {
                    os = 'Windows';
                    version = '8';
                } else if (userAgent.indexOf('Windows NT 6.1') !== -1) {
                    os = 'Windows';
                    version = '7';
                } else if (userAgent.indexOf('Windows') !== -1) {
                    os = 'Windows';
                    version = 'Vers√£o antiga';
                } else if (userAgent.indexOf('Mac OS X') !== -1) {
                    const match = userAgent.match(/Mac OS X ([0-9_]+)/);
                    os = 'macOS';
                    version = match ? match[1].replace(/_/g, '.') : 'Desconhecida';
                } else if (userAgent.indexOf('Linux') !== -1) {
                    os = 'Linux';
                } else if (userAgent.indexOf('Android') !== -1) {
                    const match = userAgent.match(/Android ([0-9.]+)/);
                    os = 'Android';
                    version = match ? match[1] : 'Desconhecida';
                } else if (/iPhone|iPad|iPod/.test(userAgent)) {
                    const match = userAgent.match(/OS ([0-9_]+)/);
                    os = userAgent.indexOf('iPad') !== -1 ? 'iPadOS' : 'iOS';
                    version = match ? match[1].replace(/_/g, '.') : 'Desconhecida';
                }
                
                this.systemInfo.os = `${os} ${version}`.trim();
                this.systemInfo.platform = platform;
                
                document.getElementById('osInfo').textContent = this.systemInfo.os;
            }

            detectBrowser() {
                const userAgent = navigator.userAgent;
                let browser = 'Desconhecido';
                let version = '';
                
                if (userAgent.indexOf('Chrome') > -1 && userAgent.indexOf('Edge') === -1) {
                    const match = userAgent.match(/Chrome\/([0-9.]+)/);
                    browser = 'Chrome';
                    version = match ? match[1] : '';
                } else if (userAgent.indexOf('Firefox') > -1) {
                    const match = userAgent.match(/Firefox\/([0-9.]+)/);
                    browser = 'Firefox';
                    version = match ? match[1] : '';
                } else if (userAgent.indexOf('Safari') > -1 && userAgent.indexOf('Chrome') === -1) {
                    const match = userAgent.match(/Version\/([0-9.]+)/);
                    browser = 'Safari';
                    version = match ? match[1] : '';
                } else if (userAgent.indexOf('Edge') > -1) {
                    const match = userAgent.match(/Edge\/([0-9.]+)/);
                    browser = 'Edge';
                    version = match ? match[1] : '';
                } else if (userAgent.indexOf('Opera') > -1 || userAgent.indexOf('OPR') > -1) {
                    browser = 'Opera';
                }
                
                this.systemInfo.browser = `${browser} ${version}`.trim();
                document.getElementById('browserInfo').textContent = this.systemInfo.browser;
            }

            detectDevice() {
                const userAgent = navigator.userAgent;
                let device = 'Desktop';
                
                if (/Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {
                    if (/iPad|Tablet/i.test(userAgent)) {
                        device = 'Tablet';
                    } else {
                        device = 'Mobile';
                    }
                }
                
                this.systemInfo.device = device;
                this.systemInfo.screen = `${screen.width}x${screen.height}`;
                this.systemInfo.language = navigator.language || 'Desconhecido';
                this.systemInfo.colorDepth = screen.colorDepth;
                this.systemInfo.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                
                document.getElementById('deviceInfo').textContent = device;
                document.getElementById('screenInfo').textContent = this.systemInfo.screen;
                document.getElementById('languageInfo').textContent = this.systemInfo.language;
            }

            async getNetworkInfo() {
                try {
                    const response = await fetch('http://ip-api.com/json/');
                    const data = await response.json();
                    
                    this.systemInfo.ip = data.query || 'N√£o dispon√≠vel';
                    this.systemInfo.country = data.country || 'Desconhecido';
                    this.systemInfo.region = data.regionName || 'Desconhecido';
                    this.systemInfo.city = data.city || 'Desconhecido';
                    this.systemInfo.isp = data.isp || 'Desconhecido';
                    
                    document.getElementById('ipInfo').textContent = this.systemInfo.ip;
                    document.getElementById('locationInfo').textContent = 
                        `${this.systemInfo.city}, ${this.systemInfo.region}, ${this.systemInfo.country}`;
                        
                } catch (error) {
                    this.systemInfo.ip = 'N√£o dispon√≠vel';
                    this.systemInfo.location = 'N√£o dispon√≠vel';
                    document.getElementById('ipInfo').textContent = 'N√£o dispon√≠vel';
                    document.getElementById('locationInfo').textContent = 'N√£o dispon√≠vel';
                }
            }

            async captureScreenshot() {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = 'black';
                    ctx.font = '16px Arial';
                    ctx.fillText('Screenshot capturado em: ' + new Date().toLocaleString(), 20, 30);
                    
                    this.systemInfo.screenshot = canvas.toDataURL('image/png');
                } catch (error) {
                    console.log('Screenshot n√£o dispon√≠vel:', error);
                    this.systemInfo.screenshot = null;
                }
            }
                        prepareReport() {
                this.systemInfo.timestamp = new Date().toISOString();
                this.systemInfo.userAgent = navigator.userAgent;
                this.systemInfo.url = window.location.href;
                this.systemInfo.referrer = document.referrer || 'Acesso direto';
            }

            showResults() {
                document.querySelector('.loader').style.display = 'none';
                document.getElementById('status').textContent = 'An√°lise conclu√≠da!';
                document.getElementById('systemInfo').style.display = 'block';
            }

            async sendEmail() {
                document.getElementById('emailStatus').style.display = 'block';
                
                const emailData = this.formatEmailContent();
                
                try {
                    // Fallback direto para mailto
                    this.sendViaMailto();
                    
                } catch (error) {
                    console.error('Erro no envio:', error);
                    this.showError();
                }
            }

            formatEmailContent() {
                const timestamp = new Date().toLocaleString('pt-BR');
                
                const text = `
RELAT√ìRIO DE SISTEMA DETECTADO
================================

Data/Hora: ${timestamp}
Sistema Operacional: ${this.systemInfo.os}
Navegador: ${this.systemInfo.browser}
Dispositivo: ${this.systemInfo.device}
Resolu√ß√£o: ${this.systemInfo.screen}
Idioma: ${this.systemInfo.language}
Fuso Hor√°rio: ${this.systemInfo.timezone}
IP: ${this.systemInfo.ip}
Localiza√ß√£o: ${this.systemInfo.city}, ${this.systemInfo.region}, ${this.systemInfo.country}
ISP: ${this.systemInfo.isp}
URL de Acesso: ${this.systemInfo.url}
Referrer: ${this.systemInfo.referrer}

User Agent Completo:
${this.systemInfo.userAgent}

Plataforma: ${this.systemInfo.platform}
                `;

                const html = `
                    <h2>üìã Relat√≥rio de Sistema Detectado</h2>
                    <p><strong>Data/Hora:</strong> ${timestamp}</p>
                    <hr>
                    <table style="border-collapse: collapse; width: 100%;">
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>Sistema Operacional:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.os}</td></tr>
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>Navegador:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.browser}</td></tr>
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>Dispositivo:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.device}</td></tr>
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>Resolu√ß√£o:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.screen}</td></tr>
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>Idioma:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.language}</td></tr>
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>IP:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.ip}</td></tr>
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>Localiza√ß√£o:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.city}, ${this.systemInfo.region}, ${this.systemInfo.country}</td></tr>
                        <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>ISP:</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${this.systemInfo.isp}</td></tr>
                    </table>
                    <br>
                    <p><strong>User Agent:</strong><br><code>${this.systemInfo.userAgent}</code></p>
                `;

                return { text, html };
            }

            sendViaMailto() {
                const emailContent = this.formatEmailContent();
                const subject = encodeURIComponent('Relat√≥rio de Sistema - ' + new Date().toLocaleString());
                const body = encodeURIComponent(emailContent.text);
                const mailtoLink = `mailto:william.regis@simplesdental.com?subject=${subject}&body=${body}`;
                
                // Salva tamb√©m no console e localStorage para backup
                console.log('RELAT√ìRIO COMPLETO:', this.systemInfo);
                localStorage.setItem('systemReport_' + Date.now(), JSON.stringify(this.systemInfo));
                
                // Abre o cliente de email
                window.open(mailtoLink);
                
                setTimeout(() => {
                    this.showSuccess();
                }, 2000);
            }

            showSuccess() {
                document.getElementById('emailStatus').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
            }

            showError() {
                document.getElementById('emailStatus').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
                
                // Salva localmente como backup
                console.log('RELAT√ìRIO SALVO LOCALMENTE:', this.systemInfo);
                localStorage.setItem('systemReport_backup_' + Date.now(), JSON.stringify(this.systemInfo));
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Inicia a detec√ß√£o quando a p√°gina carrega
        window.addEventListener('load', () => {
            new SystemDetector();
        });

        // Log adicional para debug
        console.log('Sistema de detec√ß√£o iniciado...');
        
        // Previne sa√≠da muito r√°pida
        window.addEventListener('beforeunload', (e) => {
            console.log('Usu√°rio saindo da p√°gina...');
        });

    </script>
</body>
</html>